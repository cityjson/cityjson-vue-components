var CityjsonVueComponents=function(e,t,i,r,s,a){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,s=s&&s.hasOwnProperty("default")?s.default:s,a=a&&a.hasOwnProperty("default")?a.default:a;var n=function(e,t,i,r,s,a,n,c,o,d){"boolean"!=typeof n&&(o=c,c=n,n=!1);var l,u="function"==typeof i?i.options:i;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,s&&(u.functional=!0)),r&&(u._scopeId=r),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,o(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=l):t&&(l=n?function(){t.call(this,d(this.$root.$options.shadowRoot))}:function(e){t.call(this,c(e))}),l)if(u.functional){var h=u.render;u.render=function(e,t){return l.call(t),h(e,t)}}else{var f=u.beforeCreate;u.beforeCreate=f?[].concat(f,l):[l]}return i},c=n({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"card mb-2",class:{"border-primary":e.selected},attrs:{id:e.cityobject_id}},[i("div",{staticClass:"card-header"},[i("div",{staticClass:"d-flex justify-content-between"},[i("div",{staticClass:"text-truncate"},[i("a",{attrs:{href:"#",id:"objicon",title:e.cityobject.type}},[i("i",{class:e.iconType})]),e._v(" "),i("a",{staticClass:"text-dark text-decoration-none mr-5",attrs:{href:"#"},on:{click:e.select_this}},[e._v(e._s(e.cityobject_id))])]),e._v(" "),i("div",{staticClass:"col-auto p-0"},[e.hasAttributes?i("a",{attrs:{href:"#"},on:{click:function(t){e.expanded=!e.expanded}}},[i("i",{staticClass:"fas text-secondary mr-1",class:[e.expanded?"fa-minus":"fa-plus"]})]):e._e(),e._v(" "),i("a",{attrs:{href:"#"},on:{click:function(t){e.edit_mode=!e.edit_mode}}},[i("i",{staticClass:"fas fa-pen mr-1",class:[e.edit_mode?"text-dark":"text-secondary"]})])])]),e._v(" "),i("small",{directives:[{name:"show",rawName:"v-show",value:"parents"in e.cityobject,expression:"'parents' in cityobject"}]},[e._v("\n      Parents:\n      "),e._l(e.cityobject.parents,function(t){return i("a",{key:t,attrs:{href:"#"+t,title:t}},[i("i",{staticClass:"text-danger",class:e.getIconStyle(e.getObject(t),!1)})])})],2),e._v(" "),i("small",{directives:[{name:"show",rawName:"v-show",value:"children"in e.cityobject,expression:"'children' in cityobject"}]},[e._v("\n      Children:\n      "),e._l(e.cityobject.children,function(t){return i("a",{key:t,attrs:{href:"#"+t,title:t}},[i("i",{staticClass:"text-success",class:e.getIconStyle(e.getObject(t),!1)})])})],2)]),e._v(" "),e.hasAttributes&&e.expanded||e.edit_mode?i("div",{staticClass:"card-body collapse show",attrs:{id:e.cityobject_id+"Body"}},[i("table",{directives:[{name:"show",rawName:"v-show",value:0==e.edit_mode,expression:"edit_mode == false"}],staticClass:"table table-striped table-borderless overflow-auto"},[i("tbody",e._l(e.cityobject.attributes,function(t,r){return i("tr",{key:r},[i("th",{staticClass:"py-1",attrs:{scope:"row"}},[i("small",{staticClass:"font-weight-bold"},[e._v(e._s(r))])]),e._v(" "),i("td",{staticClass:"py-1"},[i("small",[e._v(e._s(t))])])])}),0)]),e._v(" "),e.edit_mode?i("div",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.jsonString,expression:"jsonString"}],staticClass:"form-control",attrs:{id:"json_data"},domProps:{value:e.jsonString},on:{input:function(t){t.target.composing||(e.jsonString=t.target.value)}}}),e._v(" "),i("div",{staticClass:"d-flex justify-content-end mt-2"},[i("button",{staticClass:"btn btn-success btn-sm",attrs:{type:"button"},on:{click:e.saveChanges}},[e._v("Save")])])]):e._e()]):e._e()])},staticRenderFns:[]},void 0,{name:"CityObjectCard",props:{cityobject:Object,cityobject_id:String,selected:{type:Boolean,default:!1},expanded:{type:Boolean,default:!1}},data:function(){return{edit_mode:!1}},computed:{hasAttributes:function(){return"attributes"in this.cityobject&&Object.keys(this.cityobject.attributes).length>0},iconType:function(){return this.getIconStyle(this.cityobject)},jsonString:{get:function(){return JSON.stringify(this.cityobject,void 0,4)}}},methods:{select_this:function(){this.$parent.$emit("object_clicked",this.cityobject_id)},getObject:function(e){return this.$parent.citymodel.CityObjects[e]},getIconStyle:function(e,t){void 0===t&&(t=!0);var i={Building:["fas","fa-building","text-danger","mr-1"],BuildingPart:["far","fa-building","text-danger","mr-1"],BuildingInstallation:["fas","fa-city","text-danger","mr-1"],Bridge:["fas","fa-archway","text-dark","mr-1"],BridgePart:["fas","fa-archway","text-secondary","mr-1"],BridgeInstallation:["fas","fa-archway","text-primary","mr-1"],BridgeConstructionElement:["fas","fa-archway","text-warning","mr-1"],CityObjectGroup:["fas","fa-cubes","text-dark","mr-1"],CityFurniture:["fas","fa-store-alt","text-danger","mr-1"],GenericCityObject:["fas","fa-cube","text-danger","mr-1"],LandUse:["fas","fa-chart-area","text-success","mr-1"],PlantCover:["fas","fa-leaf","text-success","mr-1"],Railway:["fas","fa-train","text-primary","mr-1"],Road:["fas","fa-road","text-dark","mr-1"],SolitaryVegetationObject:["fas","fa-tree","text-success","mr-1"],TINRelief:["fas","fa-mountain","text-success","mr-1"],TransportSquare:["fas","fa-circle-notch","text-dark","mr-1"],Tunnel:["fas","fa-dot-circle","text-dark","mr-1"],TunnelPart:["fas","fa-dot-circle","text-dark","mr-1"],TunnelInstallation:["fas","fa-dot-circle","text-warning","mr-1"],WaterBody:["fas","fa-water","text-primary","mr-1"]};if(e.type in i){var r=i[e.type];return t||r.splice(2,1),r}return["fas","fa-question","text-secondary","mr-1"]},saveChanges:function(){var e=t.escapeSelector(this.cityobject_id),i=t("#"+e+" #json_data").val();this.cityobject=JSON.parse(i),this.$emit("input",this.cityobject)}}},void 0,!1,void 0,void 0,void 0),o=n({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",{attrs:{id:e.cityobject_id}},[i("div",[e.isFolder?i("a",{staticClass:"mr-1",attrs:{href:"#"},on:{click:e.toggle}},[i("i",{staticClass:"far text-dark text-decoration-none",class:[e.isOpen?"fa-minus-square":"fa-plus-square"]})]):i("span",{staticClass:"mr-1"},[i("i",{staticClass:"far fa-square text-secondary"})]),e._v(" "),i("a",{attrs:{href:"#",id:"objicon",title:e.item.type}},[i("i",{class:e.iconType})]),e._v(" "),i("a",{staticClass:"text-dark text-decoration-none",attrs:{href:"#"},on:{click:e.select_this}},[i("span",{class:{"text-primary":e.selected}},[e._v(e._s(e.cityobject_id))])]),e._v(" "),e._l(e.singleGeometries,function(t,r){return i("a",{key:r,staticClass:"badge badge-primary mr-1",attrs:{href:"#",title:t.type}},[i("i",{staticClass:"mr-1",class:e.getGeometryIcon(t.type)}),i("small",[e._v(e._s(t.lod))])])}),e._v(" "),e._l(e.geometryInstances,function(e,t){return i("span",{key:t,staticClass:"badge badge-secondary mr-1"},[i("i",{staticClass:"fas fa-external-link-alt"})])})],2),e._v(" "),e.isFolder?i("ul",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"isOpen"}],staticClass:"list-unstyled ml-4 mb-0"},e._l(e.item.children,function(t){return i("CityObjectsTreeItem",{key:t,staticClass:"item",attrs:{item:e.getObject(t),cityobject_id:t,selected_objid:e.selected_objid}})}),1):e._e()])},staticRenderFns:[]},void 0,{name:"CityObjectsTreeItem",props:{item:Object,cityobject_id:String,selected_objid:String},data:function(){return{isOpen:!1}},created:function(){var e=this;this.$on("object_clicked",function(t){e.$parent.$emit("object_clicked",t)})},computed:{selected:function(){return this.cityobject_id==this.selected_objid},singleGeometries:function(){return i.pickBy(this.item.geometry,function(e){return e.lod})},geometryInstances:function(){return i.pickBy(this.item.geometry,function(e){return"GeometryInstance"==e.type})},isFolder:function(){return this.item.children&&this.item.children.length},iconType:function(){return this.getIconStyle(this.item)}},methods:{select_this:function(){this.$parent.$emit("object_clicked",this.cityobject_id)},toggle:function(){this.isFolder&&(this.isOpen=!this.isOpen)},makeFolder:function(){this.isFolder||(this.$emit("make-folder",this.item),this.isOpen=!0)},getObject:function(e){return this.$parent.citymodel.CityObjects[e]},getGeometryIcon:function(e){var t={MultiSurface:["fas","fa-map"],Solid:["fas","fa-cube"],MultiSolid:["fas","fa-cubes"]};return e in t?t[e]:["fas","fa-question"]},getIconStyle:function(e,t){void 0===t&&(t=!0);var i={Building:["fas","fa-building","text-danger","mr-1"],BuildingPart:["far","fa-building","text-danger","mr-1"],BuildingInstallation:["fas","fa-city","text-danger","mr-1"],Bridge:["fas","fa-archway","text-dark","mr-1"],BridgePart:["fas","fa-archway","text-secondary","mr-1"],BridgeInstallation:["fas","fa-archway","text-primary","mr-1"],BridgeConstructionElement:["fas","fa-archway","text-warning","mr-1"],CityObjectGroup:["fas","fa-cubes","text-dark","mr-1"],CityFurniture:["fas","fa-store-alt","text-danger","mr-1"],GenericCityObject:["fas","fa-cube","text-danger","mr-1"],LandUse:["fas","fa-chart-area","text-success","mr-1"],PlantCover:["fas","fa-leaf","text-success","mr-1"],Railway:["fas","fa-train","text-primary","mr-1"],Road:["fas","fa-road","text-dark","mr-1"],SolitaryVegetationObject:["fas","fa-tree","text-success","mr-1"],TINRelief:["fas","fa-mountain","text-success","mr-1"],TransportSquare:["fas","fa-circle-notch","text-dark","mr-1"],Tunnel:["fas","fa-dot-circle","text-dark","mr-1"],TunnelPart:["fas","fa-dot-circle","text-dark","mr-1"],TunnelInstallation:["fas","fa-dot-circle","text-warning","mr-1"],WaterBody:["fas","fa-water","text-primary","mr-1"]};if(e.type in i){var r=i[e.type];return t||r.splice(2,1),r}return["fas","fa-question","text-secondary","mr-1"]}}},void 0,!1,void 0,void 0,void 0),d=n({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",{staticClass:"list-unstyled overflow-auto px-3"},e._l(e.cityobjects,function(t,r){return i("CityObjectsTreeItem",{directives:[{name:"show",rawName:"v-show",value:e.matches(r,t),expression:"matches(coid, cityobject)"}],key:r,attrs:{item:t,cityobject_id:r,selected_objid:e.selected_objid}})}),1)},staticRenderFns:[]},void 0,{name:"CityObjectsTree",components:{CityObjectsTreeItem:o},props:["cityobjects","selected_objid","matches"],computed:{citymodel:function(){return this.$parent.citymodel}},created:function(){var e=this;this.$on("object_clicked",function(t){e.$parent.$emit("object_clicked",t)})}},void 0,!1,void 0,void 0,void 0),l=n({render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"col-12 px-0 h-100",attrs:{id:"viewer"}})},staticRenderFns:[]},void 0,{name:"ThreeJsViewer",props:{citymodel:Object,selected_objid:String,object_colors:Object,background_color:{type:Number,default:14282492}},data:function(){return{camera_init:!1}},beforeCreate:function(){this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.raycaster=null,this.mouse=null,this.geoms={},this.meshes=[],this.mesh_index={}},mounted:async function(){var e=this;this.$parent.$emit("rendering",!0),setTimeout(async function(){e.initScene(),Object.keys(e.citymodel).length>0&&await e.loadCityObjects(e.citymodel),e.renderer.render(e.scene,e.camera);var i=e;t("#viewer").dblclick(function(e){0==e.button&&i.handleClick()}),e.$parent.$emit("rendering",!1)},25)},watch:{background_color:function(e){this.renderer.setClearColor(e),this.renderer.render(this.scene,this.camera)},object_colors:{handler:function(e){for(var t=0;t<this.meshes.length;t++)this.meshes[t].material.color.setHex(e[this.citymodel.CityObjects[this.meshes[t].name].type]);this.renderer.render(this.scene,this.camera)},deep:!0},citymodel:{handler:async function(e){var t=this;this.$parent.$emit("rendering",!0),setTimeout(async function(){t.clearScene(),Object.keys(e).length>0&&await t.loadCityObjects(e),t.renderer.render(t.scene,t.camera),t.$parent.$emit("rendering",!1)},25)},deep:!0},selected_objid:function(e,t){if(null!=t){var i=this.citymodel.CityObjects[t].type;this.mesh_index[t].material.color.setHex(this.object_colors[i])}null!=e&&this.mesh_index[e].material.color.setHex(14525696),this.renderer.render(this.scene,this.camera)}},methods:{handleClick:function(){var e=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(event.clientX-e.left)/this.renderer.domElement.clientWidth*2-1,this.mouse.y=-(event.clientY-e.top)/this.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);var t=this.raycaster.intersectObjects(this.meshes);if(0!=t.length){var i=t[0].object.name;this.$parent.$emit("object_clicked",i)}else this.$parent.$emit("object_clicked",null)},initScene:function(){this.scene=new r.Scene;var e=t("#viewer").width()/t("#viewer").height();this.camera=new r.PerspectiveCamera(60,e,.001,1e3),this.camera.up.set(0,0,1),this.renderer=new r.WebGLRenderer({antialias:!0}),document.getElementById("viewer").appendChild(this.renderer.domElement),this.renderer.setSize(t("#viewer").width(),t("#viewer").height()),this.renderer.setClearColor(this.background_color),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=r.PCFSoftShadowMap;var i=this;this.raycaster=new r.Raycaster,this.mouse=new r.Vector2;var a=new r.AmbientLight(16777215,.7);this.scene.add(a);var n=new r.SpotLight(14540253);n.position.set(84616,-1,447422),n.target=this.scene,n.castShadow=!0,n.intensity=.4,n.position.normalize(),this.scene.add(n),this.controls=new s(this.camera,this.renderer.domElement),this.controls.addEventListener("change",function(){i.renderer.render(i.scene,i.camera)})},clearScene:function(){for(;this.scene.children.length>0;)this.scene.remove(this.scene.children[0]);var e=new r.AmbientLight(16777215,.7);this.scene.add(e);var t=new r.SpotLight(14540253);t.position.set(84616,-1,447422),t.target=this.scene,t.castShadow=!0,t.intensity=.4,t.position.normalize(),this.scene.add(t)},loadCityObjects:async function(e){var t,i=new r.Geometry;for(t=0;t<e.vertices.length;t++){var s=new r.Vector3(e.vertices[t][0],e.vertices[t][1],e.vertices[t][2]);i.vertices.push(s)}for(i.normalize(),t=0;t<e.vertices.length;t++)e.vertices[t][0]=i.vertices[t].x,e.vertices[t][1]=i.vertices[t].y,e.vertices[t][2]=i.vertices[t].z;var a=this.getStats(e.vertices),n=a[3],c=a[4],o=a[5];this.camera_init||(this.camera.position.set(0,0,2),this.camera.lookAt(n,c,o),this.controls.target.set(n,c,o),this.controls.screenSpacePanning=!0,this.camera_init=!0);var d={};for(var l in e.CityObjects){var u=await this.parseObject(l,e);for(t in u)d[u[t]]=l;var h=e.CityObjects[l].type,f=new r.MeshLambertMaterial;f.color.setHex(this.object_colors[h]);var m=l,y=new r.Mesh(this.geoms[m],f);y.name=l,y.castShadow=!0,y.receiveShadow=!0,this.scene.add(y),this.meshes.push(y),this.mesh_index[m]=y}},parseObject:async function(e,t){if(null!=t.CityObjects[e].children)return t.CityObjects[e].children;var i=new r.Geometry,s=t.CityObjects[e].geometry[0].type,n=[];"Solid"==s?n=t.CityObjects[e].geometry[0].boundaries[0]:"MultiSurface"==s||"CompositeSurface"==s?n=t.CityObjects[e].geometry[0].boundaries:"MultiSolid"!=s&&"CompositeSolid"!=s||(n=t.CityObjects[e].geometry[0].boundaries);var c,o,d=0,l=[],u=[];for(c=0;c<n.length;c++){for(o=0;o<n[c][0].length;o++){var h=n[c][0][o];if(l.includes(h)){var f=l.indexOf(h);u.push(f)}else{var m=new r.Vector3(t.vertices[h][0],t.vertices[h][1],t.vertices[h][2]);i.vertices.push(m),l.push(h),u.push(d),d+=1}}if(3==u.length)i.faces.push(new r.Face3(u[0],u[1],u[2]));else if(u.length>3){var y=[];for(o=0;o<u.length;o++)y.push({x:t.vertices[l[u[o]]][0],y:t.vertices[l[u[o]]][1],z:t.vertices[l[u[o]]][2]});var v=await this.get_normal_newell(y),b=[];for(o=0;o<y.length;o++){var p=await this.to_2d(y[o],v);b.push(p.x),b.push(p.y)}var g=await a(b,null,2);for(o=0;o<g.length;o+=3)i.faces.push(new r.Face3(u[g[o]],u[g[o+1]],u[g[o+2]]))}u=[]}i.computeFaceNormals();var _=e;return this.geoms[_]=i,""},getStats:function(e){var t=Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MAX_VALUE,s=0,a=0,n=0,c=0;for(var o in e)s+=e[o][0],e[o][0]<t&&(t=e[o][0]),a+=e[o][1],e[o][1]<i&&(i=e[o][1]),e[o][2]<r&&(r=e[o][2]),n+=e[o][2],c+=1;return[t,i,r,s/c,a/c,n/c]},get_normal_newell:function(e){for(var t=[0,0,0],i=0;i<e.length;i++){var s=i+1;s==e.length&&(s=0),t[0]=t[0]+(e[i].y-e[s].y)*(e[i].z+e[s].z),t[1]=t[1]+(e[i].z-e[s].z)*(e[i].x+e[s].x),t[2]=t[2]+(e[i].x-e[s].x)*(e[i].y+e[s].y)}return new r.Vector3(t[0],t[1],t[2]).normalize()},to_2d:function(e,t){e=new r.Vector3(e.x,e.y,e.z);var i=new r.Vector3(1.1,1.1,1.1);i.distanceTo(t)<.01&&i.add(new r.Vector3(1,2,3));var s=i.dot(t),a=t.clone();a.multiplyScalar(s),i.sub(a),i.normalize();var n=t.clone();return n.cross(i),{x:e.dot(i),y:e.dot(n)}}}},void 0,!1,void 0,void 0,void 0),u=Object.freeze({__proto__:null,CityObjectCard:c,CityObjectsTree:d,CityObjectsTreeItem:o,ThreeJsViewer:l});var h={install:function e(t){e.installed||(e.installed=!0,Object.keys(u).forEach(function(e){t.component(e,u[e])}))}},f=null;return"undefined"!=typeof window?f=window.Vue:"undefined"!=typeof global&&(f=global.Vue),f&&f.use(h),e.CityObjectCard=c,e.CityObjectsTree=d,e.CityObjectsTreeItem=o,e.ThreeJsViewer=l,e.default=h,e}({},$,_,THREE,OrbitControls,earcut);